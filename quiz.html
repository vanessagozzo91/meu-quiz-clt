<!DOCTYPE html>

<html lang="pt-BR">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>An√°lise de Cr√©dito Expressa</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	<script src="https://unpkg.com/imask"></script>
	
	<script>
		// Pixel do Facebook
		!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.com/en_US/fbevents.js');fbq('init', '1406224567314703');fbq('track', 'PageView');
	</script>
	<noscript>
		<img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1406224567314703&ev=PageView&noscript=1"/>
	</noscript>

	<style>
		/* Mantenha seu CSS aqui (Simplificado para o exemplo) */
		body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; margin:0; padding-top: 60px; padding-bottom: 60px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
		.hidden { display: none; }
		.form-card { max-width: 500px; width: 90%; margin: 0px auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 8px 25px rgba(0,0,0,0.1); text-align:center; border: 1px solid #f0f4f7; }
		.orange-text-gradient { background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-weight: 700; }
		.page-header-logo { margin-bottom: 30px; text-align: center; }
		.question h3 { font-size: 1.5rem; margin-bottom: 15px; font-weight: 600; color: #1f2937; }
		.step-indicator { font-size: 0.95rem; font-weight: 500; margin-bottom: 25px; color: #6b7280; }
		.option-btn { display:block; width:100%; padding:18px; margin-bottom:15px; border-radius:12px; background: linear-gradient(90deg, #ff6b35 0%, #f7931e 100%); border: none; cursor:pointer; font-weight: 700; font-size: 1.05rem; color: #ffffff; transition: all 0.3s; box-shadow: 0 6px 15px rgba(247, 147, 30, 0.4); line-height: 1.2; }
		.input-group { display: flex; gap: 10px; margin-top: 15px; }
		.input-group input { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #d1d5db; background-color: #f9fafb; color: #1f2937; font-size: 1.1rem; box-sizing: border-box; text-align: center; transition: border 0.3s, box-shadow 0.3s; }
		#cpf-error-message, #idade-error-message { color: #ef4444; font-size: 0.85rem; margin-top: 5px; font-weight: 500; }
		.title-message { font-size: 1.8rem; font-weight: 700; color: #ef4444; margin: 30px 0 15px; }	
		.result-text { color: #4b5563; }	
		.cta-btn { display: inline-flex; align-items: center; margin-top: 25px; padding: 15px 35px; background: linear-gradient(90deg, #ff6b35 0%, #f7931e 100%); color: white; border-radius: 12px; font-size: 1.15rem; font-weight: 700; text-decoration: none; transition: all 0.3s; box-shadow: 0 8px 20px rgba(247, 147, 30, 0.4); cursor: pointer; border: none; }
		.quiz-title { font-size: 1.5rem; margin-bottom: 1.25rem; padding-bottom: 0.75rem; border-bottom: 1px solid #e5e7eb; color: #000; }
		/* Adicione ou remova outros estilos conforme necess√°rio */
	</style>
</head>

<body>
	
	<div class="form-card" id="formContainer">
		
		<div class="page-header-logo">
			<div class="text-center leading-tight">
				<span class="logo-text-size logo-text-bold text-black">ESPECIAL</span>
				<span class="logo-text-size logo-text-bold orange-text-gradient">CR√âDITO</span>
			</div>
		</div>

		<h1 class="quiz-title text-black">
			<span class="orange-text-gradient">Pr√©-An√°lise</span> R√°pida
		</h1>
		
		<div id="step-info" class="step-indicator"></div>

		<div id="quizQuestions">
			
			<div id="question1" class="question" data-step="1" data-q-key="q1">
				<h3>A empresa onde voc√™ trabalha tem:</h3>
				<button class="option-btn" data-answer="Menos de 20 funcionarios" onclick="nextQuestion(1, this)">Menos de 20 funcion√°rios</button>
				<button class="option-btn" data-answer="Mais de 20 funcion√°rios" onclick="nextQuestion(1, this)">Mais de 20 funcion√°rios</button>
			</div>

			<div id="question2" class="question hidden" data-step="2" data-q-key="q2">
				<h3>H√° quanto tempo voc√™ est√° registrado no seu emprego atual?</h3>
				<button class="option-btn" data-answer="Menos de 2 meses" onclick="nextQuestion(2, this)">Menos de 2 meses</button>
				<button class="option-btn" data-answer="Mais de 2 meses" onclick="nextQuestion(2, this)">Mais de 2 meses</button>
			</div>

			<div id="question3" class="question hidden" data-step="3" data-q-key="q3">
				<h3>Voc√™ j√° realizou algum empr√©stimo consignado CLT?</h3>
				<button class="option-btn" data-answer="J√° realizei" onclick="nextQuestion(3, this)">J√° realizei</button>
				<button class="option-btn" data-answer="Ainda n√£o" onclick="nextQuestion(3, this)">Ainda n√£o</button>
			</div>
			
			<div id="question4" class="question hidden" data-step="4">
				<h3>Sua pr√©-an√°lise foi <span class="orange-text-gradient">aprovada</span>! Para simula√ß√£o, informe <span class="orange-text-gradient">CPF e Data de Nascimento</span>:</h3>
				
				<div class="input-group">
					<input type="text" id="cpf-input" placeholder="CPF (000.000.000-00)" maxlength="14" required>
					<input type="text" id="birth-date-input" placeholder="Nascimento (DD/MM/AAAA)" maxlength="10" required>
				</div>
				
				<p id="cpf-error-message" class="hidden">Por favor, digite um CPF v√°lido com 11 d√≠gitos.</p>
				<p id="idade-error-message" class="hidden">‚ùå Idade fora da pol√≠tica (21 a 59 anos).</p>
				
				<p class="text-sm mt-3 text-gray-500">Seus dados s√£o usados apenas para a simula√ß√£o com o consultor e n√£o ser√£o armazenados sem consentimento.</p>
				
				<button class="cta-btn" id="cpf-btn">
					<svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24" width="24" height="24">
						<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.516"/>
					</svg>
					REALIZAR SIMULA√á√ÉO
				</button>
			</div>
		</div>

		<div id="resultFail" class="hidden">
			<div class="title-message">PR√â-AN√ÅLISE CONCLU√çDA</div>
			<p class="result-text text-lg">Obrigado pelo seu interesse! No momento, seu perfil n√£o atende aos requisitos m√≠nimos de cr√©dito Consignado CLT.</p>
		</div>
	</div>
	
	<iframe name="iframeLeadTarget" id="iframeLeadTarget" style="display:none;"></iframe>

	<script>
		// ‚≠êÔ∏è‚≠êÔ∏è POR FAVOR, CONFIRA ESTES DOIS VALORES! ‚≠êÔ∏è‚≠êÔ∏è
		const WHATSAPP_PHONE = '5514974000725';	
		// üö® SUBSTITUA pelo URL de EXECU√á√ÉO DA SUA IMPLANTA√á√ÉO MAIS RECENTE do Apps Script
		const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwN9E1jzxWcMrDHzaloTumRzDAZlggoYz0y9j-F2XK1oZP-_nlQQmhRjT-DqYGONPRE/exec';	
		// ‚≠êÔ∏è‚≠êÔ∏è ----------------------------------------- ‚≠êÔ∏è‚≠êÔ∏è
		
		const totalSteps = 4;
		let currentStep = 1;
		
		// Objeto de dados do quiz com TODOS os campos de rastreamento
		let quizData = {
			fbclid: '',
			fbp: '',	
			utm_source: '',
			utm_campaign: '',
			ad_id: '',
			utm_medium: '',
			utm_content: '',
			utm_term: '',
			placement: '',
			quiz_aprovado: '' // NOVO: Campo para rastrear o status de aprova√ß√£o no quiz
		};
		
		const cpfInput = document.getElementById('cpf-input');
		const dateInput = document.getElementById('birth-date-input');
		const cpfBtn = document.getElementById('cpf-btn');
		const cpfErrorMsg = document.getElementById('cpf-error-message');
		const idadeErrorMsg = document.getElementById('idade-error-message');

		// M√°scaras
		const cpfMask = IMask(cpfInput, { mask: '000.000.000-00' });
		const dateMask = IMask(dateInput, { mask: '00/00/0000' });

		function updateStepIndicator() {
			const stepElement = document.getElementById('step-info');
			const displayStep = Math.min(currentStep, 3);
			stepElement.innerHTML = `Passo <span class="orange-text-gradient">${displayStep}</span> de 3`;
		}
		
		// Fun√ß√£o para calcular a idade
		function calculateAge(birthDateString) {
			const parts = birthDateString.split('/');
			if (parts.length !== 3) return null;
			
			const day = parseInt(parts[0], 10);
			const month = parseInt(parts[1], 10) - 1;
			const year = parseInt(parts[2], 10);
			
			const today = new Date();
			const birthDate = new Date(year, month, day);

			let age = today.getFullYear() - birthDate.getFullYear();
			const m = today.getMonth() - birthDate.getMonth();
			
			if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
				age--;
			}
			return age;
		}

		// Fun√ß√£o para ler o cookie _fbp
		function getFBP() {
			const name = '_fbp=';
			const decodedCookie = decodeURIComponent(document.cookie);
			const ca = decodedCookie.split(';');
			for(let i = 0; i <ca.length; i++) {
				let c = ca[i];
				while (c.charAt(0) === ' ') {
					c = c.substring(1);
				}
				if (c.indexOf(name) === 0) {
					return c.substring(name.length, c.length);
				}
			}
			return '';
		}

		function readTrackingParamsFromQuery() {
			console.log("Iniciando leitura de par√¢metros e cookies...");
			
			const queryString = window.location.search;
			if (queryString) {
				const urlParams = new URLSearchParams(queryString);
				
				quizData.fbclid = urlParams.get("fbclid") || '';
				quizData.utm_source = urlParams.get("utm_source") || '';
				quizData.utm_campaign = urlParams.get("utm_campaign") || '';
				quizData.ad_id = urlParams.get("ad_id") || urlParams.get("utm_id") || '';
				
				quizData.utm_medium = urlParams.get("utm_medium") || '';
				quizData.utm_content = urlParams.get("utm_content") || '';
				quizData.utm_term = urlParams.get("utm_term") || '';
				quizData.placement = urlParams.get("placement") || '';
			}	
			
			// Lendo o FBP (Corre√ß√£o para o Meta ver o FBP no navegador e servidor)
			quizData.fbp = getFBP();	

			console.log("SUCESSO: Par√¢metros lidos. FBP: " + (quizData.fbp ? quizData.fbp : 'N√ÉO ENCONTRADO'));
		}

		document.addEventListener('DOMContentLoaded', () => {
			readTrackingParamsFromQuery();	
			updateStepIndicator();
		});

		function nextQuestion(step, button) {
			const answer = button.getAttribute('data-answer');
			
			// REGRA DE REPROVA√á√ÉO Q1: Tamanho da Empresa (Menos de 20 funcion√°rios)
			if (step === 1 && answer === "Menos de 20 funcionarios") {
				quizData.quiz_aprovado = 'false'; // NOVO: Define como reprovado
				showFail();
				return;
			}
			
			// REGRA DE REPROVA√á√ÉO Q2: Tempo de CLT (Menos de 2 meses)
			if (step === 2 && answer === "Menos de 2 meses") {
				quizData.quiz_aprovado = 'false'; // NOVO: Define como reprovado
				showFail();
				return;
			}

			// REGRA DE REPROVA√á√ÉO Q3: Consignado Anterior (J√° realizei)
			if (step === 3 && answer === "J√° realizei") {
				quizData.quiz_aprovado = 'false'; // NOVO: Define como reprovado
				showFail();
				return;
			}

			document.getElementById(`question${step}`).classList.add('hidden');
			currentStep++;
			updateStepIndicator();
			
			if (currentStep <= totalSteps) {
				document.getElementById(`question${currentStep}`).classList.remove('hidden');
			}
		}
		
		function showCpfError(show, isIdadeError = false) {
			const targetError = isIdadeError ? idadeErrorMsg : cpfErrorMsg;
			const targetInput = isIdadeError ? dateInput : cpfInput;
			
			// Limpa ambos os erros visuais antes de aplicar o novo
			cpfInput.style.border = '1px solid #d1d5db';
			cpfInput.style.boxShadow = 'none';
			dateInput.style.border = '1px solid #d1d5db';
			dateInput.style.boxShadow = 'none';
			cpfErrorMsg.classList.add('hidden');
			idadeErrorMsg.classList.add('hidden');
			
			if (show) {
				targetInput.style.border = '2px solid #ef4444';
				targetInput.style.boxShadow = '0 0 10px rgba(239, 68, 68, 0.5)';
				targetError.classList.remove('hidden');
				targetInput.focus();
			}
		}

		cpfBtn.addEventListener('click', () => {
			const unmaskedCpf = cpfMask.unmaskedValue;
			const unmaskedDate = dateMask.unmaskedValue;
			
			// 1. Valida√ß√£o do CPF
			if (unmaskedCpf.length !== 11) {
				showCpfError(true, false);
				quizData.quiz_aprovado = 'false'; // NOVO: Define como reprovado (bloqueio de submiss√£o)
				return;
			}
			
			// 2. Valida√ß√£o da Data de Nascimento (formato DD/MM/AAAA)
			if (unmaskedDate.length !== 8) {
				idadeErrorMsg.textContent = "Por favor, preencha a data completa (DD/MM/AAAA).";
				showCpfError(true, true);
				quizData.quiz_aprovado = 'false'; // NOVO: Define como reprovado (bloqueio de submiss√£o)
				return;
			}

			// 3. Valida√ß√£o da Idade (21 a 59 anos)
			const idade = calculateAge(dateMask.value);
			
			if (idade === null || idade < 21 || idade > 59) {
				idadeErrorMsg.textContent = "‚ùå Idade fora da pol√≠tica (21 a 59 anos).";
				showCpfError(true, true);
				quizData.quiz_aprovado = 'false'; // NOVO: Define como reprovado (bloqueio de submiss√£o)
				return;
			}

			// Se chegou at√© aqui, √© v√°lido!
			showCpfError(false);
			
			quizData['cpf'] = unmaskedCpf;	
			quizData['cpf_formatado'] = cpfMask.value;	
			quizData['data_nascimento'] = dateMask.value;
			quizData['idade'] = idade;
			quizData.quiz_aprovado = 'true'; // NOVO: Define como aprovado na submiss√£o

			sendLeadAndRedirect();	
		});

		// FUN√á√ÉO FINAL DE ENVIO CAPI E REDIRECIONAMENTO
		
		function generateWhatsAppURL() {
			const cpfFormatado = quizData.cpf_formatado || 'N√£o Informado';
			const dataNascimento = quizData.data_nascimento || 'N√£o Informada';
			
			const mensagemPura = `*PR√â-APROVADO* ‚úÖ\n\nCPF: ${cpfFormatado}\nData de Nascimento: ${dataNascimento}\n\nOl√°! Gostaria de falar com o consultor para realizar minha simula√ß√£o de cr√©dito.`;
			
			return `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(mensagemPura)}`;
		}

		function redirectToWhatsApp() {
			const whatsappUrl = generateWhatsAppURL();
			
			const newWindow = window.open(whatsappUrl, '_blank');	
			
			if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
				window.location.href = whatsappUrl;
			}
		}

		function sendLeadFormSubmission(dadosLead) {
			const form = document.createElement('form');
			form.method = 'POST';
			form.action = APPS_SCRIPT_URL;
			form.target = 'iframeLeadTarget';	
			form.style.display = 'none';

			dadosLead.timestamp_local = new Date().toLocaleString('pt-BR');
			dadosLead.page_url = window.location.href;
			dadosLead.user_agent = navigator.userAgent;	

			for (const key in dadosLead) {
				if (dadosLead.hasOwnProperty(key)) {
					const input = document.createElement('input');
					input.type = 'hidden';
					input.name = key;
					input.value = dadosLead[key];
					form.appendChild(input);
				}
			}

			document.body.appendChild(form);
			form.submit();
			console.log('Dados do Lead enviados para a planilha via formul√°rio:', dadosLead);
			
			setTimeout(() => form.remove(), 1000);
		}

		// üü¢ FUN√á√ÉO sendLeadAndRedirect CORRIGIDA PARA DEDUPLICA√á√ÉO E CORRESPOND√äNCIA AVAN√áADA NO PIXEL üü¢
		function sendLeadAndRedirect() {
			// 1. GERA√á√ÉO DO EVENT_ID √öNICO (CLIENT)
			// CHAVE DE DEDUPLICA√á√ÉO - CORRIGE O ERRO DE COBERTURA 0%
			const eventId = `lead_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;

			// Monta o objeto final de dados para o APPS SCRIPT
			const dadosLead = {
				cpf: quizData.cpf || '',	
				data_nascimento: quizData.data_nascimento || '',
				idade: quizData.idade || '',
				fbclid: quizData.fbclid || '',
				fbp: quizData.fbp || '', // FBP lido do cookie
				utm_source: quizData.utm_source || '',
				utm_campaign: quizData.utm_campaign || '',
				ad_id: quizData.ad_id || '',
				utm_medium: quizData.utm_medium || '',
				utm_content: quizData.utm_content || '',
				utm_term: quizData.utm_term || '',
				placement: quizData.placement || '',
				event_id: eventId, // CHAVE DE DEDUPLICA√á√ÉO ENVIADA PARA O SERVIDOR
				quiz_aprovado: quizData.quiz_aprovado || 'false' // NOVO: Adiciona o status de aprova√ß√£o
			};
			
			// ‚≠êÔ∏è Prepara os dados de cliente para o Pixel (Correspond√™ncia Avan√ßada) ‚≠êÔ∏è
			// Formato de Anivers√°rio (DOB) esperado: YYYYMMDD
			let dob = '';
			if (quizData.data_nascimento && quizData.data_nascimento.length === 10) {
				const [day, month, year] = quizData.data_nascimento.split('/');
				dob = year + month + day;
			}

			const userDataPixel = {};
			// CPF n√£o formatado vai como Identifica√ß√£o Externa (External ID) - Corre√ß√£o da Taxa 0% no Navegador
			if (quizData.cpf) {
				userDataPixel.external_id = quizData.cpf;
			}
			// Data de nascimento (DOB)
			if (dob) {
				userDataPixel.dob = dob;
			}
			// Adiciona o fbp (FBP) - Corre√ß√£o da Taxa 0% no Servidor
			if (quizData.fbp) {
				userDataPixel.fbp = quizData.fbp;
			}
			
			console.log("Objeto 'dadosLead' que ser√° enviado para a planilha:", dadosLead);
			console.log("Dados de Usu√°rio enviados para o Pixel (Correspond√™ncia Avan√ßada):", userDataPixel);

			// 2. ENVIA LEAD PARA O APPS SCRIPT (POST)
			sendLeadFormSubmission(dadosLead);

			// 3. DISPARA O EVENTO LEAD DO PIXEL COM DEDUPLICA√á√ÉO E CORRESPOND√äNCIA AVAN√áADA
			fbq('track', 'Lead',	
				userDataPixel,	
				// Op√ß√µes de Deduplica√ß√£o
				{	
					eventID: eventId // Event ID para match com o CAPI
				}
			);
			
			// üõë CORRIGIDO: Removida a linha abaixo.
			// O evento 'QuizPassou' ser√° disparado APENAS via API (servidor)
			// quando voc√™ confirmar que o lead tem op√ß√£o de cr√©dito.
			// fbq('trackCustom', 'QuizPassou');	
			
			// 4. REDIRECIONA PARA O WHATSAPP
			setTimeout(() => {
				redirectToWhatsApp();
			}, 500);
		}

		function showFail() {
			document.getElementById('quizQuestions').classList.add('hidden');
			document.getElementById('step-info').classList.add('hidden');
			document.getElementById('resultFail').classList.remove('hidden');
			
			// Reprovado - envia External ID (CPF) e FBP para atribui√ß√£o, se dispon√≠veis
			const userDataPixel = {};
			if (quizData.cpf) {
				userDataPixel.external_id = quizData.cpf;
			}
			if (quizData.fbp) {
				userDataPixel.fbp = quizData.fbp;
			}

			// AQUI EST√Å A MUDAN√áA: 'QuizReprovado' trocado por 'Lead_Disqualificado_PIXEL'
			fbq('trackCustom', 'Lead_Disqualificado_PIXEL', userDataPixel);	
		}
	</script>
</body>
</html>








