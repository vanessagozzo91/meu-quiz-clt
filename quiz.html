<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análise de Crédito Expressa</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/imask"></script>
    
    <!-- Pixel do Facebook -->
    <script>
        !function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window, document,'script','https://connect.facebook.com/en_US/fbevents.js');fbq('init', '1406224567314703');fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1406224567314703&ev=PageView&noscript=1"/>
    </noscript>

    <!-- CSS (Estilos) -->
    <style>
        /* Fundo da página em Cinza Claro */
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f7f9fb;
            margin:0; 
            padding-top: 60px; 
            padding-bottom: 60px;
        }
        .hidden { display: none; }
        .form-card { 
            max-width: 500px; 
            margin: 0px auto; 
            background: #fff; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 8px 25px rgba(0,0,0,0.1); 
            text-align:center; 
            border: 1px solid #f0f4f7; 
        }
        /* Aplica o gradiente laranja ao texto */
        .orange-text-gradient {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        /* Estilo para o Logo no topo */
        .page-header-logo {
            position: absolute;
            top: 25px; 
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
            width: 100%;
            max-width: 500px; 
            text-align: center;
        }
        .page-header-logo .text-black { color: #000 !important; }

        /* PERGUNTA */
        .question h3 { 
            font-size: 1.5rem; 
            margin-bottom: 15px; 
            font-weight: 600; 
            color: #1f2937; 
        }

        /* Indicador de Passo */
        .step-indicator {
            font-size: 0.95rem;
            font-weight: 500;
            margin-bottom: 25px;
            color: #6b7280; 
        }
        
        /* ESTILO DO BOTÃO DE OPÇÃO EM GRADIENTE LARANJA */
        .option-btn { 
            display:block; 
            width:100%; 
            padding:18px; 
            margin-bottom:15px; 
            border-radius:12px; 
            background: linear-gradient(90deg, #ff6b35 0%, #f7931e 100%);
            border: none;
            cursor:pointer; 
            font-weight: 700; 
            font-size: 1.05rem;
            color: #ffffff;
            transition: all 0.3s; 
            box-shadow: 0 6px 15px rgba(247, 147, 30, 0.4); 
        }
        .option-btn:hover { 
            background: linear-gradient(90deg, #f7931e 0%, #ff6b35 100%);
            color: #ffffff;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(247, 147, 30, 0.5);
        }

        /* Campo de CPF */
        #cpf-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #d1d5db;
            background-color: #f9fafb;
            color: #1f2937;
            font-size: 1.1rem;
            margin-top: 15px;
            box-sizing: border-box;
            text-align: center;
            /* Adicionado estilo para feedback de erro */
            transition: border 0.3s, box-shadow 0.3s; 
        }

        /* Mensagens finais */
        .title-message { font-size: 1.8rem; font-weight: 700; color: #ef4444; margin: 30px 0 15px; } 
        .result-text { color: #4b5563; } 


        /* Estilo do botão CTA (Laranja) - Mantido e agora usado para CPF */
        .cta-btn { 
            display: inline-flex;
            align-items: center;
            margin-top: 25px;
            padding: 15px 35px; 
            background: linear-gradient(90deg, #ff6b35 0%, #f7931e 100%);
            color: white; 
            border-radius: 12px; 
            font-size: 1.15rem; 
            font-weight: 700; 
            text-decoration: none;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(247, 147, 30, 0.4);
            cursor: pointer;
        }
        .cta-btn:hover { 
            background: linear-gradient(90deg, #f7931e 0%, #ff6b35 100%);
            box-shadow: 0 10px 25px rgba(247, 147, 30, 0.5);
        }

        /* Estilos do H1 */
        .quiz-title {
            font-size: 1.5rem;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid #e5e7eb;
            color: #000;
        }

        /* Estilos do Header/Logo */
        .logo-text-bold { font-weight: 700; letter-spacing: 0.05em; }
        .logo-text-size { font-size: 1.5rem; }
        .text-center { text-align: center; }
        .leading-tight { line-height: 1.25; } 

        /* Estilos de P */
        .text-sm { font-size: 0.875rem; }
        .mt-3 { margin-top: 0.75rem; }
        .text-gray-500 { color: #6b7280; }
    </style>
</head>
<body>
    
    <div class="page-header-logo">
        <div class="text-center leading-tight">
            <span class="logo-text-size logo-text-bold text-black">ESPECIAL</span>
            <span class="logo-text-size logo-text-bold orange-text-gradient">CRÉDITO</span>
        </div>
    </div>

    <div class="form-card" id="formContainer">
        
        <h1 class="quiz-title text-black">
            <span class="orange-text-gradient">Pré-Análise</span> Rápida
        </h1>
        
        <div id="step-info" class="step-indicator"></div>

        <div id="quizQuestions">
            <div id="question1" class="question" data-step="1" data-q-key="q1">
                <h3>Quantos meses você está registrado no seu emprego atual?</h3>
                <button class="option-btn" data-answer="Menos de 6 meses" onclick="nextQuestion(1, this)">Menos de 6 meses</button>
                <button class="option-btn" data-answer="6 meses ou mais" onclick="nextQuestion(1, this)">6 meses ou mais</button>
            </div>

            <div id="question2" class="question hidden" data-step="2" data-q-key="q2">
                <h3>Você já realizou algum empréstimo consignado CLT?</h3>
                <button class="option-btn" data-answer="Já realizei" onclick="nextQuestion(2, this)">Já realizei</button>
                <button class="option-btn" data-answer="Ainda não" onclick="nextQuestion(2, this)">Ainda não</button>
            </div>
            
            <div id="question3" class="question hidden" data-step="3">
                <h3>Sua pré-análise foi <span class="orange-text-gradient">aprovada</span>! Para realizar a simulação, informe seu <span class="orange-text-gradient">CPF</span>:</h3>
                <input type="text" id="cpf-input" placeholder="000.000.000-00" maxlength="14" required>
                <p class="text-sm mt-3 text-gray-500">Seu CPF é usado apenas para a simulação com o consultor e não será armazenado sem consentimento.</p>
                
                <button class="cta-btn" id="cpf-btn">
                    <svg class="w-6 h-6 mr-3" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.465 3.516"/>
                    </svg>
                    REALIZAR SIMULAÇÃO
                </button>
            </div>

        </div>

        <div id="resultFail" class="hidden">
            <div class="title-message">PRÉ-ANÁLISE CONCLUÍDA</div>
            <p class="result-text text-lg">Obrigado pelo seu interesse! No momento, seu perfil não atende aos requisitos mínimos de crédito Consignado CLT.</p>
        </div>
    </div>
    
    <!-- Iframe Oculto para Submissão Assíncrona do Formulário CAPI -->
    <!-- Este iframe evita que a página recarregue ao enviar o lead para o Apps Script -->
    <iframe name="iframeLeadTarget" id="iframeLeadTarget" style="display:none;"></iframe>


    <script>
        const WHATSAPP_PHONE = '5514974000725'; 
        // ⭐️ URL ATUALIZADA DO APPS SCRIPT FORNECIDA POR VOCÊ
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwa741GFr8uclrmbROGNECNLE8vGBF-oLKqOofHRAyHQqF0CqpNxvKCqDIAWq9BZjIFvA/exec'; 
        
        const totalSteps = 3; 
        let currentStep = 1;
        // Objeto para armazenar APENAS o CPF e os dados de rastreio.
        let quizData = {};
        
        const cpfInput = document.getElementById('cpf-input');
        // Máscara de CPF
        const cpfMask = IMask(cpfInput, { mask: '000.000.000-00' });

        function updateStepIndicator() {
            const stepElement = document.getElementById('step-info');
            stepElement.innerHTML = `Passo <span class="orange-text-gradient">${currentStep}</span> de ${totalSteps}`;
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            updateStepIndicator();
        });

        function nextQuestion(step, button) {
            const answer = button.getAttribute('data-answer');
            
            // Lógica de desqualificação (Mantida)
            if (step === 1 && answer === "Menos de 6 meses") {
                showFail();
                return;
            }
            if (step === 2 && answer === "Já realizei") {
                showFail();
                return;
            }

            document.getElementById(`question${step}`).classList.add('hidden');
            currentStep++;
            updateStepIndicator();
            
            if (currentStep <= totalSteps) {
                document.getElementById(`question${currentStep}`).classList.remove('hidden');
            }
        }
        
        document.getElementById('cpf-btn').addEventListener('click', () => {
            const unmaskedCpf = cpfMask.unmaskedValue;
            
            if (unmaskedCpf.length === 11) {
                // CPF SEM máscara para o CAPI/Planilha
                quizData['cpf'] = unmaskedCpf; 
                // CPF COM máscara para a mensagem do WhatsApp 
                quizData['cpf_formatado'] = cpfMask.value; 

                sendLeadAndRedirect(); 
            } else {
                // Feedback visual para o CPF inválido (melhor que alert)
                cpfInput.style.border = '2px solid #ef4444';
                cpfInput.style.boxShadow = '0 0 10px rgba(239, 68, 68, 0.5)';
                setTimeout(() => {
                    cpfInput.style.border = '1px solid #d1d5db';
                    cpfInput.style.boxShadow = 'none';
                }, 2000);
                cpfInput.focus();
            }
        });


        // FUNÇÃO FINAL DE ENVIO CAPI E REDIRECIONAMENTO
        
        function generateWhatsAppURL() {
            const cpfFormatado = quizData.cpf_formatado || 'Não Informado';
            
            const mensagemPura = `*PRÉ-APROVADO* ✅\n\nCPF para Simulação: ${cpfFormatado}\n\nOlá! Gostaria de falar com o consultor para realizar minha simulação de crédito.`;
            
            return `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(mensagemPura)}`;
        }

        function redirectToWhatsApp() {
            const whatsappUrl = generateWhatsAppURL();
            
            // Tenta o redirecionamento mais forte para sair do Iframe e redirecionar a página principal.
            try {
                window.top.location.href = whatsappUrl; 
            } catch (e) {
                // Se for bloqueado, usa a janela atual como fallback.
                console.error("Redirecionamento bloqueado. Usando fallback de janela.");
                window.location.href = whatsappUrl;
            }
        }

        function getTrackingParams() {
            let params = {};
            try {
                // Tenta pegar a URL do site pai (Google Sites)
                const url = new URL(window.parent.location.href);
                params = url.searchParams;
            } catch (e) {
                console.warn("Não foi possível acessar a URL pai. Usando a URL atual do Iframe.");
                params = new URL(window.location.href).searchParams;
            }
            return params;
        }

        // NOVO: Função para enviar o Lead via submissão de formulário (Mais robusto que fetch no Iframe)
        function sendLeadFormSubmission(dadosLead) {
            // Cria um formulário dinâmico
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = APPS_SCRIPT_URL;
            form.target = 'iframeLeadTarget'; // Direciona a submissão para o iframe oculto
            form.style.display = 'none';

            // Adiciona campos ocultos ao formulário
            for (const key in dadosLead) {
                if (dadosLead.hasOwnProperty(key)) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = key;
                    input.value = dadosLead[key];
                    form.appendChild(input);
                }
            }

            document.body.appendChild(form);

            // Submete o formulário
            form.submit();
            console.log('Lead enviado via submissão de formulário (CAPI).');
            
            // Remove o formulário após a submissão
            setTimeout(() => form.remove(), 1000);
        }

        function sendLeadAndRedirect() {
            // 1. DISPARA O EVENTO DE LEAD NO PIXEL (Navegador) 
            fbq('track', 'Lead'); 
            
            // 2. CAPTURA PARÂMETROS
            const params = getTrackingParams();
            
            // Monta o objeto final de dados para o Apps Script (APENAS CPF E RASTREIO)
            const dadosLead = {
                cpf: quizData.cpf || '', 
                fbclid: params.get("fbclid") || '',
                utm_source: params.get("utm_source") || '',
                utm_campaign: params.get("utm_campaign") || '',
                ad_id: params.get("ad_id") || '',
                user_agent: navigator.userAgent
            };

            // 3. ENVIA LEAD PARA O APPS SCRIPT (CAPI Server) usando submissão de formulário robusta
            sendLeadFormSubmission(dadosLead);

            // 4. REDIRECIONA PARA O WHATSAPP
            // Damos um pequeno atraso para garantir que a submissão da forma inicie antes de redirecionar.
            setTimeout(() => {
                redirectToWhatsApp();
            }, 300);
        }

        function showFail() {
            document.getElementById('quizQuestions').classList.add('hidden');
            document.getElementById('step-info').classList.add('hidden');
            document.getElementById('resultFail').classList.remove('hidden');
            fbq('trackCustom', 'QuizReprovado'); 
        }
    </script>
</body>
</html>
